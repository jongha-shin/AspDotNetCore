<%
'* 일반 게시판에서 사용
'***************************************************************************************
'목록 현재 페이지 색상 지정( SUB : PageList(RowCount,PageSize,Page,BlockSize,Page_Link))에서 사용
' CONST PageSize = 30 '한페이지에 보여질 레코드 수
BlockSize = 10 ' 이동을 위한 블럭 단위
New_Icon_Day = 3 ' 뉴 아이콘 설정일
Board_Button_Path="/nansysman/image/"
User_Button_Path="/nansysman/image/"
User_New_Icon="&nbsp;<img src='"&User_Button_Path&"icon_n.gif' width=10 height=11 align='absmiddle' border='0'>"
File_Icon="&nbsp;<img src='"&User_Button_Path&"file.gif' align='absmiddle' border='0'>"

init_yy  = 1920 ' 이력서 최저 년도
last_yy  = year(date) ' 이력서 최고 년도
Max_File_Size=724288000 '500M 까지
Max_Script_Time=1800 '파일 업로드 스크립트 타임
'Dim File_path : File_Path="E:\inetpub_E\wwwroot_E\pns\" '서버
'Dim File_Save_path : File_Save_path="E:\inetpub_E\wwwroot_E\pns\dataroom\" '서버
'Dim File_path : File_Path="C:\Inetpub\wwwroot\hosting\pns\" '로컬
'Dim File_Save_Path : File_Save_Path="C:\Inetpub\wwwroot\hosting\pns\dataroom\" '로컬

Drq_Pop_Url="" 'Dr1 팝업 Url

'########## 코드 화면 출력
Sub Print(x)
	Response.write x&"<br>"
End Sub

'########## 레코드 셋 해제
Sub Rs_Close(Rs) 
	If Rs.State = 1 Then 
		Rs.Close : Set Rs=Nothing
	End If 
End Sub 

Sub Db_Close(Db) 
	If Db.State = 1 Then 
		Db.Close : Set Db=Nothing
	End If 
End Sub 


'########## 카테고리 코드 자리수 맞추기
'code:코드값, code_su : 코드 자리수
Function fn_code(code1,code_su)
'	Dim i
'	If code1<>"" Then
	If Len(code1) < code_su Then
		For i = Len(code1)+1 To code_su
			code1="0"&code1
		Next
	Else
		'정해진 자리수가 넘을 경우 무조건 절삭(Right:앞절삭,Left:뒤자리절삭) 
		code1=Right(code1,code_su)
	End If
'	End If
	fn_code=code1
End Function

Function fn_code_blank(code2,code_su)
	Dim i_cd2
	If Len(code2) < code_su Then
		For i_cd2 = Len(code2)+1 To code_su
			code2="0"&code2
		Next
	Else
		code2=Right(code2,code_su)
	End If
	fn_code_blank=code2
End Function

'########## 현재까지만 나이 구하기
Function fn_bf_year(bDate)
    sDate = Date  '시스템날짜
   TDate = Year(Date) & "-" & Month(bDate) & "-" & Day(bDate)  '생일을 년도만 현재 년도로 바꿈
    If Right(sDate,5) > Right(bDate,5) Then
        sTmp = CStr(Year(sDate) - Year(bDate))
    Else
        sTmp =CStr(Year(sDate) - Year(bDate)) - 1
    End If
	fn_bf_year=sTmp
End Function

'########## 사고일기준 만 나이 구하기(기준일,생년월일)
Function fn_bf1_year(s1Date,bDate1)
    If Right(s1Date,5) > Right(bDate1,5) Then
        sTmp1 = CStr(Year(s1Date) - Year(bDate1))
    Else
         sTmp1 =CStr(Year(s1Date) - Year(bDate1))-1
    End If
	fn_bf1_year=sTmp1
End Function

'########## 두 날짜간 기간 구하기(시작일,종료일)
Function fn_bt_year(sDate,eDate)
	If sDate="" OR eDate="" Then
		uDate = -1
	Else
		uDate = DateDiff("D",sDate,eDate)
		If uDate < 0 Then
			uDate = -1
		End If
	End If
	fn_bt_year=uDate+1
End Function

'##########  H계수 계산(달수)
Function H_count(sItem1,sMon)
	h_total=0
	For i=1 To sMon
		h_total= h_total + (1/(1+(5/1200*i)))
	Next
	If sItem1="3" Then
'		If h_total>240.0000 Then
'			h_total=240.0000
'		End If
	End If
	h_total=Fix(h_total*10000)/10000
	H_count=FormatNumber(h_total,4)
End Function

Function H_count1(sItem1,sMon)
	h_total=0
	For i=1 To sMon
		h_total= h_total + (1/(1+(5/1200*i)))
	Next
	h_total=Fix(h_total*10000)/10000
	H_count1=FormatNumber(h_total,4)
End Function

Function Minus_zero(minus_to_zero) ' H계수1 - H계수2, L계수1 -L계수2가  0보다 작을 경우 0 처리
	If minus_to_zero<=0 Then
		minus_to_zero=0
	End If
	Minus_zero = minus_to_zero
End Function

'########## 멱(Power)함수
Function L_power(sValue,sMon)
	s=1
	For jjj=1 To sMon
		s=  s * sValue
	Next
	L_power=s
End Function

'##########  L계수 계산(달수)
Function L_count(sMon)
	l_total=0
	l_per=(1.0+(5/1200))
	For iii=1 To sMon
		l_total= l_total + (1.0/L_power(l_per,iii))
	Next
	l_total=Fix(l_total*10000)/10000
	L_count=FormatNumber(l_total,4)
End Function

'##########  미성년자/사고일/정년 기간 월수 구하기
Function fn_death_term(s1Date,s2Date)
	If s1Date="" OR s2Date="" Then ' 두 날짜중 하나라도 값이 없으면 월수 0 처리
		inter_month=0
	Else
		s1_yy=Left(s2Date,4)
		s1_mm=Mid(s2Date,6,2)
		s1_dd=Right(s2Date,2)
		s2_yy=Left(s1Date,4)
		s2_mm=Mid(s1Date,6,2)
		s2_dd=Right(s1Date,2)
		If s2_mm>s1_mm or s2_dd>s1_dd Then
			s1_yy=Int(s1_yy)-1
			s1_mm=Int(s1_mm)+11
			s1_dd=Int(s1_dd)+30
			inter_yy=Int(s1_yy)-Int(s2_yy)
			inter_mm=Int(s1_mm)-Int(s2_mm)
			inter_dd=Int(s1_dd)-Int(s2_dd)
			If  inter_dd>=30 Then
				inter_mm=Int(inter_mm)+1
			End If
		Else
			inter_yy=Int(s1_yy)-Int(s2_yy)
			inter_mm=Int(s1_mm)-Int(s2_mm)
			inter_dd=Int(s1_dd)-Int(s2_dd)
			If  inter_dd>=30 Then
				inter_mm=Int(inter_mm)+1
			End If
		End If
		inter_month=Cint(inter_yy)*12 + inter_mm
		If inter_month<0 Then
			inter_month=0
		End If
	End If
	fn_death_term=inter_month
End Function

'########## 위자료 계산
'(서비스구분,법률상/보험약관상 구분,보험가입일,장해급수/장해율,전체입원일수/만나이,통원일수)
'(서비스구분,보험약관상 구분,보험가입일,합산장해율,만나이,통원일수)
Function fn_alimony(sItem,sGubun,sDate,sSu,sIpwon,sTong)
	uAlimony_value=0
	If sIpwon="" Then sIpwon=0
	If sTong="" Then sTong=0
If sItem="1" Then
	If sGubun="1" Then ' 법률상 위자료 계산
		uAlimony=sIpwon+Int(sTong*(1/3))
		If uAlimony<=10 Then
			uAlimony_value="200000"
		ElseIf uAlimony>10 AND uAlimony<=30 Then
			uAlimony_value="1000000"
		ElseIf uAlimony>30 AND uAlimony<=40 Then
			uAlimony_value="1500000"
		ElseIf uAlimony>40 AND uAlimony<=50 Then
			uAlimony_value="2000000"
		ElseIf uAlimony>50 AND uAlimony<=60 Then
			uAlimony_value="3000000"
		ElseIf uAlimony>60 AND uAlimony<=70 Then
			uAlimony_value="4000000"
		ElseIf uAlimony>70 AND uAlimony<=80 Then
			uAlimony_value="4500000"
		ElseIf uAlimony>80 Then
			uAlimony_value="5000000"
		End If
	ElseIf sGubun="2" Then ' 보험약관 위자료 계산
		If sDate>="2006-04-01" Then
'			fn_alimony_SQL="SELECT value FROM TB_DEGREE_VALUE WHERE gb='1' AND yy+'-'+mm+'-'+dd='2006-04-01' AND grade1='"&sSu&"' AND grade2 ="
			fn_alimony_SQL="SELECT value FROM TB_DEGREE_VALUE WHERE gb='1' AND yy+'-'+mm+'-'+dd='2006-04-01' AND grade1='"&sSu&"'"
		ElseIf sDate<"2006-04-01" AND sDate>="2001-08-01" Then
			fn_alimony_SQL="SELECT value FROM TB_DEGREE_VALUE WHERE gb='1' AND yy+'-'+mm+'-'+dd='2001-08-01' AND grade1='"&sSu&"'"
		Else
			fn_alimony_SQL="SELECT value FROM TB_DEGREE_VALUE WHERE gb='1' AND yy+'-'+mm+'-'+dd='1900-01-01' AND grade1='"&sSu&"'"
		End If
'		Print(fn_alimony_SQL)
		Set fn_alimony_Rs = Dbcon.Execute(fn_alimony_SQL)
		If fn_alimony_Rs.eof or fn_alimony_Rs.bof Then
			uAlimony_value=0
		Else
			uAlimony_value=fn_alimony_Rs("value")
		End If
	ElseIf sGubun="3" Then ' 소송시 휴업손해 계산
		uAlimony_value=Int(sIpwon/30)
	End If
ElseIf sItem="2" Then '후유장애 보험약관상 본인 위자료 계산
		'Print(" ")
		'Print(" sDate :" &sDate)
		'Print(" sSu :" &sSu)
		'Print(" 만나이 sIpwon :" &sIpwon)
	If sGubun="2" Then ' 보험약관 위자료 계산
		If sDate<"2004-08-01" Then
			fn_alimony_SQL1="SELECT value FROM TB_DEGREE_VALUE WHERE gb='2' AND yy+'-'+mm+'-'+dd='1900-01-01' AND CONVERT(DECIMAL(10,2),grade2)<="&CDbl (sSu)&" AND CONVERT(DECIMAL(10,2),grade1)>="&CDbl (sSu)
			'Print("위자료 SQL : "&fn_alimony_SQL1)
			Set fn_alimony_Rs1 = Dbcon.Execute(fn_alimony_SQL1)
			If fn_alimony_Rs1.eof or fn_alimony_Rs1.bof Then
				uAlimony_value=0
			Else
				uAlimony_value=Replace(fn_alimony_Rs1("value"),",","")
			End If
			Rs_Close(fn_alimony_Rs1)
		ElseIf sDate<"2006-04-01" AND sDate>="2004-08-01" Then
			If CDbl(sSu)>=50 Then
				If sIpwon>=20 AND sIpwon<60 Then
					uAlimony_value=45000000*sSu*0.01*0.7
				ElseIf sIpwon<20 OR sIpwon>=60 Then
					uAlimony_value=40000000*sSu*0.01*0.7
				End If
			Else
				fn_alimony_SQL1="SELECT value FROM TB_DEGREE_VALUE WHERE gb='2' AND yy+'-'+mm+'-'+dd='2004-08-01' AND CONVERT(DECIMAL(10,2),grade2)<="&CDbl (sSu)&" AND CONVERT(DECIMAL(10,2),grade1)>="&CDbl (sSu)
			'Print("위자료 SQL : "&fn_alimony_SQL1)
				Set fn_alimony_Rs1 = Dbcon.Execute(fn_alimony_SQL1)
				If fn_alimony_Rs1.eof or fn_alimony_Rs1.bof Then
					uAlimony_value=0
				Else
					uAlimony_value=Replace(fn_alimony_Rs1("value"),",","")
				End If
				Rs_Close(fn_alimony_Rs1)
			End If
		Else
			If CDbl(sSu)>=50 Then
				If sIpwon>=20 AND sIpwon<60 Then
					uAlimony_value=45000000*sSu*0.01*0.7
				ElseIf sIpwon<20 OR sIpwon>=60 Then
					uAlimony_value=40000000*sSu*0.01*0.7
				End If
			Else
				fn_alimony_SQL1="SELECT value FROM TB_DEGREE_VALUE WHERE gb='2' AND yy+'-'+mm+'-'+dd='2006-04-01' AND CONVERT(DECIMAL(10,2),grade2)<="&CDbl (sSu)&" AND CONVERT(DECIMAL(10,2),grade1)>="&CDbl (sSu)
			'Print("위자료 SQL : "&fn_alimony_SQL1)
				Set fn_alimony_Rs1 = Dbcon.Execute(fn_alimony_SQL1)
				If fn_alimony_Rs1.eof or fn_alimony_Rs1.bof Then
					uAlimony_value=0
				Else
					uAlimony_value=Replace(fn_alimony_Rs1("value"),",","")
				End If
				Rs_Close(fn_alimony_Rs1)
				End If
		End If
		'Print("위자료 금액 : "&uAlimony_value)
		'Print(" ")
	End If
End If
	fn_alimony=uAlimony_value
End Function

'########## 휴업손해액/상실수익액(법률상) 입원기간에 대한 호프만 계산
'(서비스구분,법률상/보험약관상 구분,전체입원일수,통원일수)
Function fn_h_count(sItem,sGubun,sIpwon,sTong)
	loss_value=0
	If sIpwon="" Then sIpwon=0
	If sTong="" Then sTong=0
	If sGubun="1" Then ' 법률상 상실수익 계산
		If sIpwon<10 Then
			loss_value=0 '10일 미만 0
		ElseIf sIpwon>=10 AND sIpwon<20 Then
			loss_value=H_count(1,1)*(1/3) ' 10일 이상일 경우 호프만계수 1개월 * 1/3
		ElseIf sIpwon>=20 AND sIpwon<30 Then
			loss_value=H_count(1,1)*(2/3) ' 20일 이상일 경우 호프만계수 1개월 * 2/3
		ElseIf sIpwon>=30 AND sIpwon<59 Then
			loss_value=H_count(1,1) ' 30일 이상일 경우 호프만계수 1개월
		Else
			loss1=Int(sIpwon/30) ' 입원 개월수
			loss_value=H_count(1,loss1)
		End If
	ElseIf sGubun="2" Then ' 보험약관 위자료 계산
	End If
	fn_h_count=loss_value
End Function

'########## 휴업손해액(보험약관상) 입원기간별 금액
'(서비스구분,법률상/보험약관상 구분,입원일자1,입원일자2,직업구분,직업코드,휴업일수,현실소득)
Function fn_closure(sItem,sGubun1,sYmd1,sYmd2,sCd1,sCd2,sIpwon,sKeum) '무직자일경우 전체 입원일수
	comp_value1=0
	If Mid(sCd1,4,1)="3" Then
		pCd1="3" '건설직종
		pCd2=Mid(sCd1,5,10) '건설직종
	ElseIf Mid(sCd1,4,1)="6" Then
		pCd1="6" '무직자
	Else
		pCd1="5" '평균임금
		pCd2="1" '평균임금
	End If
If sItem="1" Then
	If pCd1="6"  Then '무직자일 경우
		comp_value1=0
	ElseIf (pCd1="5" AND Left(sCd1,3)="111") OR  Trim(sCd1)=""  Then '급여소득자(신고함)/직접입력시
		comp_value1=(sKeum/30)*sIpwon*0.8
'		Print(comp_value1)
	Else ' 건설직종/나머지 직업
'############적용기간최소
		SQL_11="SELECT MAX(yy+'-'+mm+'-'+'01') FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm<='"&Left(sYmd1,7)&"'"
'		Print(SQL_11)
		Set Rs_11 = Dbcon.execute(SQL_11)
		If Not Rs_11.Eof Then
			Min_year1=Rs_11(0)
'			Print("Min : "&Min_year1)
		Else
			Min_year1=0
		End If
		Rs_Close(Rs_11)

'############적용기간최대
		SQL_11="SELECT MAX(yy+'-'+mm+'-'+'01') FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm<='"&Left(sYmd2,7)&"'"
		'Print(SQL_11)
		Set Rs_11 = Dbcon.execute(SQL_11)
		If Not Rs_11.Eof Then
			Max_year1=Rs_11(0)
			'Print("Max : "&Max_year1)
		Else
			Max_year1=0
		End If
		Rs_Close(Rs_11)

'############적용기간개수
		SQL_11="SELECT COUNT(*) FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm>='"&Left(Min_year1,7)&"' AND  yy+'-'+mm<='"&Left(Max_year1,7)&"'"
		'Print(SQL_11)
		Set Rs_11 = Dbcon.execute(SQL_11)
		If Rs_11(0)>0 Then
			Max_Cnt=Rs_11(0)
			'Print("Max_Cnt : "&Max_Cnt)
		Else
			Max_Cnt=0
		End If
		Rs_Close(Rs_11)

'############ 각 기간별 일자/금액 배열 저장
		SQL_11="SELECT yy+'-'+mm+'-'+'01',value1 FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm>='"&Left(Min_year1,7)&"' AND  yy+'-'+mm<='"&Left(Max_year1,7)&"' ORDER BY yy+'-'+mm+'-'+'01' ASC"
'		'Print(SQL_11)
		Set Rs_11 = Server.CreateObject("ADODB.Recordset")
		Rs_11.Open  SQL_11,Dbcon, 3,3
		If Not Rs_11.Eof Then
			intArrayIndex  = Max_Cnt +2
			'Print(intArrayIndex)
			countI=0
			Dim btDate()
			ReDim  Preserve btDate(intArrayIndex,2)
			Do While Not Rs_11.EOF
				If countI=1 Then
					countI=countI+1
				End If
				btDate(countI,0)=Rs_11(0)
			    btDate(countI,1)=Rs_11(1)
				'Print("Year"&countI&" : "&Rs_11(0)&" - "&Rs_11(1))
				countI =countI + 1
				Rs_11.movenext
			Loop
			btDate(1,0)=sYmd1
			btDate(intArrayIndex-1,0)=sYmd2
			btDate(1,1)=btDate(0,1)
			btDate(intArrayIndex-1,1)=btDate(countI-1,1)
			'Print("Year"&countI&" : "&btDate(intArrayIndex-1,0)&" - "&btDate(intArrayIndex-1,1))
		Else
			Cnt_year1=0
		End If
		Rs_Close(Rs_11)
		'배열출력 
		comp_day1=0
		comp_value1=0
		For i=1 to (intArrayIndex-1)
			comp_day1=comp_day1+ fn_bt_year1(btDate(i,0),btDate(i+1,0))
			If pCd1="3" Then
				comp_value1=Int(comp_value1)+ fn_bt_year1(btDate(i,0),btDate(i+1,0))*(btDate(i,1)*22/30)*0.8
'				comp_value1=Int(comp_value1)+ fn_bt_year1(btDate(i,0),btDate(i+1,0))*(btDate(i-1,1)*22/30)*0.8
			Else
				comp_value1=Int(comp_value1)+ fn_bt_year1(btDate(i,0),btDate(i+1,0))*(btDate(i,1)/30)*0.8
'				comp_value1=Int(comp_value1)+ fn_bt_year1(btDate(i,0),btDate(i+1,0))*(btDate(i-1,1)/30)*0.8
			End If
		Next
		'Print("<Font Color=red>기간별 전체 일수 : "&comp_day1&" 기간별 전체 금액 : "&FormatNumber(comp_value1,0)&"</Font>")
		Rs_Close(Rs_11)
	End If

ElseIf sItem="2" Then ' 사망사고일 경우
	If Mid(sCd1,4,1)="3" Then
		pCd1="3" '건설직종
		pCd2=Mid(sCd1,5,10) '건설직종
	ElseIf Mid(sCd1,4,1)="6" Then
		pCd1="5" '무직자
		pCd2="1" '평균임금
	Else
		pCd1="5" '평균임금
		pCd2="1" '평균임금
	End If

	If (pCd1="5" AND Left(sCd1,3)="111") OR  Trim(sCd1)="" Then '급여소득자(신고함)/직접입력시
		comp_value1=sKeum
'		comp_value1=sKeum*L_count(sIpwon)*(2/3)
	Else ' 건설직종/나머지 직업
'############적용기간최소
		SQL_11="SELECT MAX(yy+'-'+mm+'-'+'01') FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm<='"&Left(sYmd1,7)&"'"
		'Print(SQL_11)
		Set Rs_11 = Dbcon.execute(SQL_11)
		If Not Rs_11.Eof Then
			Min_year1=Rs_11(0)
		Else
			Min_year1=0
		End If
		Rs_Close(Rs_11)
		'Print("년도 : "&Min_year1)

'############ 각 기간별 일자/금액 배열 저장
		SQL_11="SELECT yy+'-'+mm,value1 FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm='"&Left(Min_year1,7)&"'"
		'Print(SQL_11)
		Set Rs_11 = Server.CreateObject("ADODB.Recordset")
		Rs_11.Open  SQL_11,Dbcon, 3,3
		If Not Rs_11.Eof Then
			If pCd1="3" Then
			     sKeum1=Replace(Rs_11(1),",","")*22
			Else
			     sKeum1=Replace(Rs_11(1),",","")
			End If
		Else
			sKeum1=sKeum
		End If
		Rs_Close(Rs_11)
'		comp_value1=sKeum1*L_count(sIpwon)*(2/3)
		If sGubun1<>"3" Then
			comp_value1=sKeum1*(sIpwon)*(2/3)
		Else
			comp_value1=sKeum1 ' 후유장해 상실수익액 임금 계산
		End If 
	End If

ElseIf sItem="3" Then ' 사망사고일 경우
	If Mid(sCd1,4,1)="3" Then
		pCd1="3" '건설직종
		pCd2=Mid(sCd1,5,10) '건설직종
	ElseIf Mid(sCd1,4,1)="6" Then
		pCd1="5" '무직자
		pCd2="1" '평균임금
	Else
		pCd1="5" '평균임금
		pCd2="1" '평균임금
	End If

	If (pCd1="5" AND Left(sCd1,3)="111") OR  Trim(sCd1)="" Then '급여소득자(신고함)/직접입력시
		comp_value1=sKeum*sIpwon*(2/3)
	Else ' 건설직종/나머지 직업
'############적용기간최소
		SQL_11="SELECT MAX(yy+'-'+mm+'-'+'01') FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm<='"&Left(sYmd1,7)&"'"
'		Print(SQL_11)
		Set Rs_11 = Dbcon.execute(SQL_11)
		If Not Rs_11.Eof Then
			Min_year1=Rs_11(0)
		Else
			Min_year1=0
		End If
		Rs_Close(Rs_11)
'		Print("년도 : "&Min_year1)

'############ 각 기간별 일자/금액 배열 저장
		SQL_11="SELECT yy+'-'+mm,value1 FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm='"&Left(Min_year1,7)&"'"
'		Print(SQL_11)
		Set Rs_11 = Server.CreateObject("ADODB.Recordset")
		Rs_11.Open  SQL_11,Dbcon, 3,3
		If Not Rs_11.Eof Then
			If pCd1="3" Then
'		Print(Rs_11(1))
			     sKeum1=Replace(Rs_11(1),",","")*22
'		Print(Rs_11(1)*22)
			Else
			     sKeum1=Replace(Rs_11(1),",","")
'		Print(Rs_11(1))
			End If
		Else
			sKeum1=sKeum
		End If
		Rs_Close(Rs_11)
		comp_value1=sKeum1*sIpwon*(2/3)
'		Print(comp_value1)
	End If

End If
	fn_closure=comp_value1
End Function

'##########  후유장애 휴업손해액() 입원기간별 금액
'(서비스구분,법률상/보험약관상 구분,입원일자1,입원일자2,직업구분,직업코드,휴업일수,현실소득)
Function fn_closure_handi(sItem,sGubun1,sYmd1,sYmd2,sCd1,sCd2,sIpwon,sKeum) '무직자일경우 전체 입원일수
%>
<!-- <FONT COLOR="GREEN"> -->
<%
	comp_value1=0
	If Mid(sCd1,4,1)="3" Then
		pCd1="3" '건설직종
		pCd2=Mid(sCd1,5,10) '건설직종
	ElseIf Mid(sCd1,4,1)="6" Then
		pCd1="6" '무직자
	Else
		pCd1="5" '평균임금
		pCd2="1" '평균임금
	End If
If sItem="1" Then
	If pCd1="6"  Then '무직자일 경우
		comp_value1=0
	ElseIf (pCd1="5" AND Left(sCd1,3)="111") OR  Trim(sCd1)=""  Then '급여소득자(신고함)/직접입력시
		comp_value1=(sKeum/30)*sIpwon*0.8
		'Print("금액 : "&sKeum)
		'Print("입원기간 : "&sIpwon)
		'Print("입원기간별 금액 : "&comp_value1)
	Else ' 건설직종/나머지 직업
'############적용기간최소
		SQL_11="SELECT MAX(yy+'-'+mm+'-'+'01') FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm<='"&Left(sYmd1,7)&"'"
		'Print(SQL_11)
		Set Rs_11 = Dbcon.execute(SQL_11)
		If Not Rs_11.Eof Then
			Min_year1=Rs_11(0)
			'Print("Min : "&Min_year1)
		Else
			Min_year1=0
		End If
		Rs_Close(Rs_11)

'############적용기간최대
		SQL_11="SELECT MAX(yy+'-'+mm+'-'+'01') FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm<='"&Left(sYmd2,7)&"'"
		'Print(SQL_11)
		Set Rs_11 = Dbcon.execute(SQL_11)
		If Not Rs_11.Eof Then
			Max_year1=Rs_11(0)
'			Print("Max : "&Max_year1)
		Else
			Max_year1=0
		End If
		Rs_Close(Rs_11)

'############적용기간개수
		SQL_11="SELECT COUNT(*) FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm>='"&Left(Min_year1,7)&"' AND  yy+'-'+mm<='"&Left(Max_year1,7)&"'"
'		Print(SQL_11)
		Set Rs_11 = Dbcon.execute(SQL_11)
		If Rs_11(0)>0 Then
			Max_Cnt=Rs_11(0)
'			Print("Max_Cnt : "&Max_Cnt)
		Else
			Max_Cnt=0
		End If
		Rs_Close(Rs_11)

'############ 각 기간별 일자/금액 배열 저장
		SQL_11="SELECT yy+'-'+mm+'-'+'01',value1 FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm>='"&Left(Min_year1,7)&"' AND  yy+'-'+mm<='"&Left(Max_year1,7)&"' ORDER BY yy+'-'+mm+'-'+'01' ASC"
'		Print(SQL_11)
		Set Rs_11 = Server.CreateObject("ADODB.Recordset")
		Rs_11.Open  SQL_11,Dbcon, 3,3
		If Not Rs_11.Eof Then
			intArrayIndex  = Max_Cnt +2
'			Print(intArrayIndex)
			countI=0
			Dim btDate()
			ReDim  Preserve btDate(intArrayIndex,2)
			Do While Not Rs_11.EOF
				If countI=1 Then
					countI=countI+1
				End If
				btDate(countI,0)=Rs_11(0)
			    btDate(countI,1)=Rs_11(1)
'				Print("Year"&countI&" : "&Rs_11(0)&" - "&Rs_11(1))
				countI =countI + 1
				Rs_11.movenext
			Loop
			btDate(1,0)=sYmd1
			btDate(intArrayIndex-1,0)=sYmd2
			btDate(1,1)=btDate(0,1)
			btDate(intArrayIndex-1,1)=btDate(countI-1,1)
'			Print("Year1 : "&btDate(1,0)&" - "&btDate(1,1))
'			Print("Year"&countI&" : "&btDate(intArrayIndex-1,0)&" - "&btDate(intArrayIndex-1,1))
		Else
			Cnt_year1=0
		End If
		Rs_Close(Rs_11)
		'배열출력 
		comp_day1=0
		comp_value1=0
		For i=1 to (intArrayIndex-1)
			comp_day1=comp_day1+ fn_bt_year1(btDate(i,0),btDate(i+1,0))
			If pCd1="3" Then
'				comp_value1=Int(comp_value1)+ fn_bt_year1(btDate(i,0),btDate(i+1,0))*(btDate(i-1,1)*22/30)*0.8
				comp_value1=Int(comp_value1)+ FormatNumber(fn_bt_year1(btDate(i,0),btDate(i+1,0))*(btDate(i,1)*22/30)*0.8,0)
'				Print("기간별 일수 : "&btDate(i,0)&"~"&btDate(i+1,0)&" : "&fn_bt_year1(btDate(i,0),btDate(i+1,0))&"일 단가, 월금액 : "&btDate(i,1)&", "&FormatNumber(btDate(i,1)*22,0)&" 합계 : "&FormatNumber(fn_bt_year1(btDate(i,0),btDate(i+1,0))*(btDate(i,1)*22/30)*0.8,0))
			Else
'				comp_value1=Int(comp_value1)+ fn_bt_year1(btDate(i,0),btDate(i+1,0))*(btDate(i-1,1)/30)*0.8
				comp_value1=Int(comp_value1)+ FormatNumber(fn_bt_year1(btDate(i,0),btDate(i+1,0))*(btDate(i,1)/30)*0.8,0)
'				Print("기간별 일수 : "&btDate(i,0)&"~"&btDate(i+1,0)&" : "&fn_bt_year1(btDate(i,0),btDate(i+1,0))&"일 단가, 월금액 : "&btDate(i,1)&", "&FormatNumber(btDate(i,1)*22,0)&" 합계 : "&FormatNumber(fn_bt_year1(btDate(i,0),btDate(i+1,0))*(btDate(i,1)*22/30)*0.8,0))
			End If
		Next
'		Print("<Font Color=red>전체 일수 : "&comp_day1&" 기간별 전체 금액 : "&FormatNumber(comp_value1,0)&"</Font>")
		Rs_Close(Rs_11)
	End If

ElseIf sItem="3" Then ' 사망사고일 경우
	If Mid(sCd1,4,1)="3" Then
		pCd1="3" '건설직종
		pCd2=Mid(sCd1,5,10) '건설직종
	ElseIf Mid(sCd1,4,1)="6" Then
		pCd1="5" '무직자
		pCd2="1" '평균임금
	Else
		pCd1="5" '평균임금
		pCd2="1" '평균임금
	End If

	If (pCd1="5" AND Left(sCd1,3)="111") OR  Trim(sCd1)="" Then '급여소득자(신고함)/직접입력시
		comp_value1=sKeum*L_count(sIpwon)*(2/3)
	Else ' 건설직종/나머지 직업
'############적용기간최소
		SQL_11="SELECT MAX(yy+'-'+mm+'-'+'01') FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm<='"&Left(sYmd1,7)&"'"
		'Print(SQL_11)
		Set Rs_11 = Dbcon.execute(SQL_11)
		If Not Rs_11.Eof Then
			Min_year1=Rs_11(0)
		Else
			Min_year1=0
		End If
		Rs_Close(Rs_11)
'		'Print("년도 : "&Min_year1)

'############ 각 기간별 일자/금액 배열 저장
		SQL_11="SELECT yy+'-'+mm,value1 FROM TB_INCOME_VALUE WHERE cd1='"&pCd1&"' AND Replace(cd2,' ','')='"&pCd2&"' AND yy+'-'+mm='"&Left(Min_year1,7)&"'"
		'Print(SQL_11)
		Set Rs_11 = Server.CreateObject("ADODB.Recordset")
		Rs_11.Open  SQL_11,Dbcon, 3,3
		If Not Rs_11.Eof Then
			If pCd1="3" Then
			     sKeum1=Replace(Rs_11(1),",","")*22
			Else
			     sKeum1=Replace(Rs_11(1),",","")
			End If
		Else
			sKeum1=sKeum
		End If
		Rs_Close(Rs_11)
'		comp_value1=sKeum1*L_count(sIpwon)*(2/3)
		comp_value1=sKeum1*(sIpwon)*(2/3)
	End If

End If
	fn_closure_handi=comp_value1
End Function

'##########  후유장애 여명구하기
'(서비스구분,소송/약관 구분,장해감정일자,장해감정일기준 만나이,성별)
Function fn_rest_yy(sItem6,sGubun6,sYmd6,sAge6,sSex6) '
	If sGubun6="1" Then
		SQL_66="SELECT TOP 1 yy+'-'+mm,value1 FROM TB_INCOME_VALUE WHERE cd1='6' AND Replace(cd2,' ','')='"&sAge6&"' AND sex='"&sSex6&"' AND  yy+'-'+mm<='"&Left(sYmd6,7)&"' ORDER BY yy+'-'+mm DESC"
		'Print(SQL_66)
		Set Rs_66 = Server.CreateObject("ADODB.Recordset")
		Rs_66.Open  SQL_66,Dbcon, 3,3
		If Not Rs_66.Eof Then
		    sRest6 = Replace(Rs_66(1),",","")
		Else
			sRest6 = 0
		End If
		Rs_Close(Rs_66)
	End If
	fn_rest_yy = Fix(sRest6*1)/1
End Function

'########## 두 날짜간 기간 구하기(시작일,종료일)
Function fn_bt_year1(sDate,eDate)
	If eDate<>"" Then
		uDate = DateDiff("D",sDate,eDate)
	Else
		uDate = 1
	End If
	fn_bt_year1=uDate
End Function

'########## 기타손해배상금액(보험약관상)
'(서비스구분,법률상/보험약관상 구분,보험가입일자,통원일수)
Function fn_baesang(sItem,sGubun,sDate,sTong)
''Print("보험가입일자 sDate : "&sDate)
''Print("통원일수 sTong : "&sTong)
	baesang_value=0
	If sTong="" Then sTong=0
	If sGubun="1" Then ' 법률상 상실수익 계산
	ElseIf sGubun="2" Then ' 보험약관 위자료 계산
		If sDate<"2006-04-01" Then
			baesang_value=5000*sTong ' 2006-04-01 이전 계약건
		Else
			baesang_value=8000*sTong ' 2006-04-01 이후 계약건
		End If
	End If
	fn_baesang=baesang_value
End Function

'########## 한시장애율 -> 연구장해로 환산
'(서비스구분,법률상/보험약관상 구분,한시/영구,만나이,기간,장해율)
Function fn_limit_unlimt(sItem,sGubun,sOpt,sAge,sMonth,sPer)
	limit_unlimt_per=0
	If sAge<=60 Then ' 사고일 기준 정년이 60이하일 경우 환산
		If sOpt="Y" Then ' 한시일 경우
			If sMonth>=1 AND sMonth<=36 Then
				limit_unlimt_per=sPer*(1/3)
			ElseIf sMonth>=37 AND sMonth<=60 Then
				limit_unlimt_per=sPer*(1/2)
			ElseIf sMonth>60 Then
				limit_unlimt_per=sPer
			End If
		Else
			limit_unlimt_per=sPer
		End If
	Else ' 사고일 기준 정년이 60이상일 경우 환산 안함
		limit_unlimt_per=sPer
	End If
	limit_unlimt_per=Fix(limit_unlimt_per*10)/10
	fn_limit_unlimt=limit_unlimt_per
End Function

'########## 합산장해율계산
'(서비스구분,법률상/보험약관상 구분,a,b)
Function fn_limit_unlimt_tot(sItem,sCnt,sGubun,sSub1,sSub2)
	limit_unlimt_per_tot=0
	If sSub2<>"" Then ' 
		limit_unlimt_per_cnt=sCnt
		limit_unlimt_per_tot= sSub1 + (1 - sSub1*0.01)*sSub2
	Else
		limit_unlimt_per_cnt=sCnt
		limit_unlimt_per_tot=0
	End If
	limit_unlimt_per_tot=Fix(limit_unlimt_per_tot*100)/100
	fn_limit_unlimt_tot=limit_unlimt_per_tot
End Function

'########## 선택직업구분
Function fn_job_desc(jCode)
	jCode1=""
	jCode2=""
	jCode_nm=""
	If Trim(Len(jCode)) > 4 Then
		jCode1=Mid(jCode,4,1)
		jCode2=Trim(Mid(jCode,5,10))
	End If
	If Left(jCode,1) = "1" Then ' 유직자
		If Mid(jCode,4,1) = "1" Then
			jCode_nm1 = " -> 표준직종"
		ElseIf Mid(jCode,4,1) = "2" Then
			jCode_nm1 = " -> 표준산업"
		ElseIf Mid(jCode,4,1) = "3" Then
			jCode_nm1 = " -> 건설직종"
		End If
		jCode_nm = "유직자 "
		If Mid(jCode,2,1)="1" AND Mid(jCode,3,1)="1" Then
			jCode_nm=jCode_nm&" -> 급여소득자(세무신고함)"
			fn_SQL="SELECT job_k FROM TB_INCOME_CODE WHERE cd1='"&jCode1&"' AND  cd2='"&jCode2&"'"
			Set fn_rs = Dbcon.execute(fn_SQL) 
			If Not fn_rs.Eof Then
				jCode_nm = jCode_nm &jCode_nm1 &" -> " &fn_rs(0) 
			End If
			Rs_Close(fn_rs)
		ElseIf Mid(jCode,2,1)="1" AND Mid(jCode,3,1)="2" Then
			jCode_nm=jCode_nm&" -> 급여소득자(세무신고안함)"
			fn_SQL="SELECT job_k FROM TB_INCOME_CODE WHERE cd1='"&jCode1&"' AND  cd2='"&jCode2&"'"
			Set fn_rs = Dbcon.execute(fn_SQL) 
			If Not fn_rs.Eof Then
				jCode_nm = jCode_nm &jCode_nm1 &" -> " &fn_rs(0) 
			End If
			Rs_Close(fn_rs)
		ElseIf Mid(jCode,2,1)="2" Then
			jCode_nm=jCode_nm &" -> 기술직 "
			fn_SQL="SELECT job_k FROM TB_INCOME_CODE WHERE cd1='"&jCode1&"' AND  cd2='"&jCode2&"'"
			Set fn_rs = Dbcon.execute(fn_SQL) 
			If Not fn_rs.Eof Then
			jCode_nm = jCode_nm &jCode_nm1 &" -> "&fn_rs(0) 
			End If
			Rs_Close(fn_rs)
		ElseIf Mid(jCode,2,1)="3" Then
			jCode_nm=jCode_nm&" -> 농부"
		ElseIf Mid(jCode,2,1)="4" Then
			jCode_nm=jCode_nm&" -> 일용직근로자"
		ElseIf Mid(jCode,2,1)="5" Then
			jCode_nm=jCode_nm&" -> 가사종사자(주부)"
		End If
	ElseIf Left(jCode,1)="2" Then ' 무직자

		jCode_nm="무직자 "
		If Mid(jCode,2,1)="1" Then
			jCode_nm=jCode_nm&" -> 미성년자(학생포함)"
		ElseIf Mid(jCode,2,1)="2" Then
			jCode_nm=jCode_nm&" -> 대학생(성년자)"
		ElseIf Mid(jCode,2,1)="3" Then
			jCode_nm=jCode_nm&" -> 군인(의무복무자)"
		ElseIf Mid(jCode,2,1)="4" Then
			jCode_nm=jCode_nm&" -> 기타 실업자 "
		End If
	Else
		jCode_nm=""
	End If

	fn_job_desc = jCode_nm
End Function

'########## 넘어오는 폼값(POST)
Function Request_Form()
	For Each objItem In Request.Form
	   makestr = objItem & " = "
	   makestr = makestr & "Request(" & chr(34) & objItem & chr(34) & ")"
	   Print(makestr & " : " & Request.Form(objItem) & "<br>")
	Next
End Function

'########## 넘어오는 폼값(GET)
Function Request_Get()
'	response.write "fail"
	For Each objItem In Request.querystring
	   makestr = objItem & " = "
	   makestr = makestr & "Request(" & chr(34) & objItem & chr(34) & ")"
	Next
End Function

'########## 글자 길이 체크
Function lenH(str)
	Dim tlen, k, i, tt

	If isNULL(str) Then
		lenH=0
		exit Function
	End If

	tlen=0
	tt=len(str)
	k=1

	For i=1 To tt
		If asc(mid(str,k,1)) < 0 Then
			tlen=tlen+2
		Else
			tlen=tlen+1
		End If

		k=k+1
	Next

	lenH=tlen

End Function

Function leftH(str,cnt)
	Dim k, i, ss

	k=1

	For i=0 To cnt
		If asc(mid(str,k,1)) <= 0 Then
			If i=cnt-1 Then
				Exit For
				End If
			i=i+1
		End If

		ss=ss & mid(str,k,1)
		k=k+1
	Next

	leftH=ss
End Function
'--------------------------------------------------------------------------------------
Function no_html(contents)

	if IsNULL(contents) then contents = ""
	contents = trim(contents)                                 '앞, 뒤 공백제거
'contents = replace(replace(contents,"<","&lt;"),">","&gt;")    '<, > 처리
	contents = replace(contents,chr(13)&chr(10),"<br>")        'Enter 처리
	contents = replace(contents,chr(32),"&nbsp;")              'Space Bar 처리
'contents = replace(contents,chr(9),"&nbsp;&nbsp;&nbsp;&nbsp;") 'Tab 처리
	contents = replace(contents,"''","'")              '작은따옴표(') 처리

	contents = replace(contents,"&lt;b&gt;","<font color=""#336699""><b>") 'Asp 코드..처리
	contents = replace(contents,"&lt;/b&gt;","</b></font>")

	contents = replace(contents,"&lt;%","<font color=""800000"">&lt;%") 'Asp 코드..처리
	contents = replace(contents,"%&gt;","%&gt;</font>")

	no_html = contents

End Function

Function no_html1(contents)

	if IsNULL(contents) then contents = ""
	contents = trim(contents)                                 '앞, 뒤 공백제거
'contents = replace(replace(contents,"<","&lt;"),">","&gt;")    '<, > 처리
'	contents = replace(contents,chr(13)&chr(10),"<br>")        'Enter 처리
'	contents = replace(contents,chr(32),"&nbsp;")              'Space Bar 처리
'contents = replace(contents,chr(9),"&nbsp;&nbsp;&nbsp;&nbsp;") 'Tab 처리
	contents = replace(contents,"''","'")              '작은따옴표(') 처리

	contents = replace(contents,"&lt;b&gt;","<font color=""#336699""><b>") '강조 코드..처리
	contents = replace(contents,"&lt;/b&gt;","</b></font>")

	contents = replace(contents,"&lt;%","<font color=""800000"">&lt;%") 'Asp 코드..처리
	contents = replace(contents,"%&gt;","%&gt;</font>")

	no_html1 = contents

End Function

Function html(contents)

	if IsNULL(contents) then contents = ""
	contents = contents         '앞, 뒤 공백제거
	contents = replace(contents,chr(10),"<br>")        'Enter 처리
	contents = replace(contents,chr(13)&chr(10),"<br>")        'Enter 처리
	contents = replace(contents,"''","'")         '작은따옴표(') 처리
	contents = replace(contents,"&lt;"&chr(37),"<font color='800000'>&lt;%")         'Asp 코드..처리
	contents = replace(contents,chr(37)&"&gt;","%&gt;</font>")         'Asp 코드..처리

	contents = replace(contents,"&lt;?","<font color='666633'>&lt;?")         'php 코드..처리
'	contents = replace(contents,"&lt;?php","<font color='666633'>&lt;?php")         'php 코드..처리
	contents = replace(contents,"?&gt;","?&gt;</font>")         'php 코드..처리

	contents = replace(contents,"&lt;jsp:","<font color='CC6600'>&lt;jsp:")         'jsp 코드..처리
'	contents = replace(contents,"/&gt;","/&gt;</font>")         'jsp 코드..처리

	contents = replace(contents,"&lt;script","<font color='FF6600'>&lt;script")         'script 코드..처리
	contents = replace(contents,"/script&gt;","script&gt;</font>")         'script 코드..처리

	contents = replace(contents,"&lt;B&gt;","<font color='3366CC'><B>")         '강조 코드..처리
	contents = replace(contents,"&lt;/B&gt;","</B></font>")         '강조 코드..처리
'	contents = replace(contents,"&lt;b&gt;","<font color='3366CC'><b>")         '강조 코드..처리
'	contents = replace(contents,"&lt;/b&gt;","</b></font>")         '강조 코드..처리
	contents = replace(contents,"&lt;br&gt;","<br>")         '강조 코드..처리
	contents = replace(contents,"&lt;/br&gt;","</br>")         '강조 코드..처리

	html = contents

End Function

Function html1(contents)

	if IsNULL(contents) then contents = ""
	contents = contents         '앞, 뒤 공백제거
'	contents = replace(contents,chr(10),"<br>")        'Enter 처리
	contents = replace(contents,"''","'")         '작은따옴표(') 처리
	contents = replace(contents,"&lt;"&chr(37),"<font color='800000'>&lt;%")         'Asp 코드..처리
	contents = replace(contents,chr(37)&"&gt;","%&gt;</font>")         'Asp 코드..처리

	contents = replace(contents,"&lt;?","<font color='666633'>&lt;?")         'php 코드..처리
'	contents = replace(contents,"&lt;?php","<font color='666633'>&lt;?php")         'php 코드..처리
	contents = replace(contents,"?&gt;","?&gt;</font>")         'php 코드..처리

	contents = replace(contents,"&lt;jsp:","<font color='CC6600'>&lt;jsp:")         'jsp 코드..처리
'	contents = replace(contents,"/&gt;","/&gt;</font>")         'jsp 코드..처리

	contents = replace(contents,"&lt;script","<font color='FF6600'>&lt;script")         'script 코드..처리
	contents = replace(contents,"/script&gt;","script&gt;</font>")         'script 코드..처리

	contents = replace(contents,"&lt;B&gt;","<font color='3366CC'><B>")         '강조 코드..처리
	contents = replace(contents,"&lt;/B&gt;","</B></font>")         '강조 코드..처리
'	contents = replace(contents,"&lt;b&gt;","<font color='3366CC'><b>")         '강조 코드..처리
'	contents = replace(contents,"&lt;/b&gt;","</b></font>")         '강조 코드..처리
	contents = replace(contents,"&lt;br&gt;","<br>")         '강조 코드..처리
	contents = replace(contents,"&lt;/br&gt;","</br>")         '강조 코드..처리

	html1 = contents

End Function

Function no_html2(contents)
	if IsNULL(contents) then contents = ""
	contents = trim(contents)                                 '앞, 뒤 공백제거
'	contents = replace(replace(contents,"<","&lt;"),">","&gt;")    '<, > 처리
'	contents = replace(contents,chr(13),"<br>")        'Enter 처리
	contents = replace(contents,chr(10),"<br>")        'Excel Enter 처리
'	contents = replace(contents,chr(13)&chr(10),"<br>")        'Enter 처리
'	contents = replace(contents,chr(32),"<br>")              'Space Bar 처리
'	contents = replace(contents,chr(9),"<br>") 'Tab 처리
'	contents = replace(contents,chr(32),"&nbsp;")              'Space Bar 처리
	contents = replace(contents,"''","'")              '작은따옴표(') 처리

'	contents = replace(contents,"&lt;%","<font color=""800000"">&lt;%") 'Asp 불능..처리
'	contents = replace(contents,"%&gt;","%&gt;</font>")

	no_html2 = contents
End Function


'***** BEGIN FUNCTIONS *****
' 이 함수는 문자열을 파라미터로 받은 후 그 문자열 내에
' http://로 시작하는 문자열이 있으면 그 문자열을 브라우저에서
' 클릭할 수 있도록 <a href=...>태그를 붙여 준다.
' 단, http://로 시작하는 문자열만 되므로, 
' http://korea.internet.com은 링크가 붙어도,
' korea.internet.com은 링크가 붙지 않는다.
Function LinkURLs(strInput)
        Dim iCurrentLocation  ' 문자열에서의 현재 위치 저장
        Dim iLinkStart        ' 현재 링크의 시작 위치
        Dim iLinkEnd          ' 현재 링크의 마지막 위치
        Dim strLinkText       ' 링크로 변환시킬 문자열
        Dim strOutput         ' 결과를 담는 문자열
 
        ' 첫 번째 문자로 초기화
        iCurrentLocation = 1
		strInput = strInput
'		strInput = strInput &"<br>"
        ' http://로 시작하는 문자열을 찾는다.
        ' 만일 찾으면 링크를 붙여준다.
        Do While InStr(iCurrentLocation, strInput, "http://", 1) > 1
                ' 링크의 시작 위치 설정
                iLinkStart = InStr(iCurrentLocation, strInput, "http://", 1)
                
                ' 링크의 마지막 위치 설정.
                ' 링크 문자열 다음의 첫 번째 공란을 기준으로 마지막 위치 설정
'                chk_br = InStr(iLinkStart, strInput, "<br>", 1)
'                chk_blank = InStr(iLinkStart, strInput, " ", 1)
'                iLinkEnd = InStr(iLinkStart, strInput, "<br>", 1)
				if InStr(iLinkStart, strInput, "<br>", 1) > InStr(iLinkStart, strInput, " ", 1) then
		                iLinkEnd = InStr(iLinkStart, strInput, " ", 1)
				elseif InStr(iLinkStart, strInput, "<br>", 1) < InStr(iLinkStart, strInput, " ", 1) then 
						iLinkEnd = InStr(iLinkStart, strInput, "<br>", 1)
				else 
						iLinkEnd = InStr(iLinkStart, strInput, "", 1)
				end if
					
                
                ' 공란을 발견하지 못한다면,
                ' 문자열의 마지막 부분까지 링크로 만듬
	               If iLinkEnd = 0 Then iLinkEnd = Len(strInput) + 1
 
                ' ., !, ? 문자가 들어 있는 경우 조심...
                Select Case Mid(strInput, iLinkEnd - 1, 1)
                      Case ".", "!"
'                      Case ".", "!", "?"
                           iLinkEnd = iLinkEnd - 1
	            End Select
                
                ' 현재 링크 작업하려는 문자열의 앞 부분을 출력 문자열 변수에 추가
                strOutput = strOutput & Mid(strInput, iCurrentLocation, iLinkStart - iCurrentLocation)
 
                ' 링크를 만들려는 문자열을 변수에 저장
                strLinkText = Mid(strInput, iLinkStart, iLinkEnd - iLinkStart)
                
                ' 링크를 만든 후 출력 문자열 변수에 추가
				If (len(strLinkText)>10 And InStr(strLinkText,".")>1) Then

					strOutput = strOutput & "<A HREF='" & strLinkText & "' target='_blank' class='nav3' style='font-size:9pt'>" & strLinkText & "</A>"
				Else
	                strOutput = strOutput &  strLinkText 
				End If
 
                ' 디버깅을 위한 코드
                'Response.Write iLinkStart & "," & iLinkEnd & "<BR>" & vbCrLf
                
                ' 현재 위치를 현재 링크의 마지막 위치로 설정
                iCurrentLocation = iLinkEnd
        Loop
        
        ' 반복문에서 출력 문자열에 더하지 않았던 나머지 문자열 추가
        strOutput = strOutput & Mid(strInput, iCurrentLocation)
        
        ' 출력 문자열 변수 반환
        LinkURLs = strOutput
End Function 'LinkURLs
'***** END FUNCTIONS *****

Function AutoLink(content) 

Dim link 
Set link = New RegExp 

' First Pass for http 
link.Pattern = "(w+)://([^/:]+)(:d*b)?([^# n<]*).*\n" 
link.Pattern = "([0-9a-zA-Z./@:~?&=_-]+)" 
link.Pattern = "http://([0-9a-zA-Z./@:~?&=_-]+)" 
link.Global = True 
link.IgnoreCase = True 

' ASP seems to be not supporting .MultiLine method. 
'link.MultiLine = True 

content = link.Replace(content,"<a target=_blank href='http://$1'>http://$1</a>") 

' 메일주소 자동링크 
link.Pattern = "([_0-9a-zA-Z-]+(\.[_0-9a-zA-Z-]+)*)@([0-9a-zA-Z-]+(\.[0-9a-zA-Z-]+)*)" 
AutoLink = link.Replace(content,"<a href='mailto:$1@$3'>$1@$3</a>") 

End Function

Function CheckWord(CheckValue)
	CheckValue = replace(CheckValue, "&" , "&amp;")
	CheckValue = replace(CheckValue, "<", "&lt;")
	CheckValue = replace(CheckValue, ">", "&gt;")
	CheckValue = replace(CheckValue, chr(34), "&quot;")
	CheckWord = CheckValue
End Function


' --------------------------------------------------------
' Function Name        : regular_replace
' Description          : 정규표현식을 이용한 대치
' -------------------------------------------------------- 

Function eregi_replace(pattern, replace, text)

	Dim eregObj

	Set eregObj= New RegExp

	eregObj.Pattern= pattern ' Set Pattern(패턴 설정)

	eregObj.IgnoreCase    = True ' Set Case Insensitivity(대소문자 구분 여부)

	eregObj.Global= True ' Set All Replace(전체 문서에서 검색)

	eregi_replace = eregObj.Replace(text, replace)    ' Replace String

End Function

' --------------------------------------------------------
' Function Name: auto_link
' Description: 문서에 있는 Url를 찾아내어  자동으로 링크
' --------------------------------------------------------

Function LinkURLs1(text)

	Dim regex_file, regex_http, regex_mail
	
	regex_file= "gz|tgz|tar|gzip|zip|rar|mpeg|mpg|exe|rpm|dep|rm|ram|asf|ace|viv|avi|mid|gif|jpg|png|bmp|eps|mov"
	
	' regex_http ="(http|https|ftp|telnet|news):\/\/(([\xA1-\xFEa-z0-9_\-]+\.[][\xA1-\xFEa-z0-9:;&#@=_~%\?\/\.\,\+\-]+)(\/|[\.]*[a-z0-9]))"
	regex_http ="(http|https|ftp|telnet|news):\/\/(([\xA1-\xFEa-z0-9_\-]+\.[][\xA1-\xFEa-z0-9:;&#@=_~%\/\.\,\+\-]+)(\/|[\.]*[a-z0-9]))"
	
	regex_mail = "([\xA1-\xFEa-z0-9_\.\-]+)@([\xA1-\xFEa-z0-9_\-]+\.[a-z0-9\-\._\-]+[\.]*[\xA1-\xFEa-z0-9\?=]*)"
	
	' img tag 와 a tag 의 경우 링크가 여러줄에 걸쳐 이루어져 있을 경우
	
	' 이를 한줄로 합침 (합치면서 부가 옵션들은 모두 삭제함)
	
	text = eregi_replace("<(a|img)[^>]*(href|src)[^>]*(" & regex_http & "|mailto:" & regex_mail & ")[^>]*>","<$1 $2=""$3"">", text)
	
	text = eregi_replace("<(a)[^>]*(href)[^>]*(" & regex_http & "|mailto:" & regex_mail & ")[^>]*>","<$1 $2=""$3"">",text)
	
	' 특수문자와 링크시 target 삭제
	
	text = eregi_replace("&(quot|gt|lt)","!$1", text)
	
	' html 사용시 Link 보호
	
	text  = eregi_replace("href=""(" & regex_http & ")""[^>]*>","href=""$2_orig://$3"" target=""_blank"" class='nav3'>", text)
	
	text  = eregi_replace("href=""mailto:(" & regex_mail & ")"">","href=""mailto:$2@$3"" class='nav3'>", text)
	
	text  = eregi_replace("(background|codebase|src)[ \n]*=[\n""' ]*(" & regex_http & ")[""']*","$1=""$3_orig://$4""",text)
	
	'링크가 안된 Url및 Email Address 자동 링크
	
	text  = eregi_replace("(" & regex_http & ")" ,"<a href=""$1"" target=""_blank"" class='nav3'>$1</a>", text)
	
	text  = eregi_replace("(" & regex_mail & ")","<a href=""mailto:$1"" class='nav3'>$1</a>", text)
	
	' 보호를 위해 치환된것 복구
	
	text = eregi_replace("!(quot|gt|lt)","&$1", text)
	
	text = eregi_replace("(http|https|ftp|telnet|news|mms)_orig","$1", text)
	
	text = eregi_replace("@","@",text)
	
	' File Link시 Target을 삭제
	
	text = eregi_replace("(\.(" & regex_file & ")"") target=""_blank""","$1", text)
	
	LinkURLs = text

End Function

'########## 이미지 사이즈 구하기
Sub GetImageSize(ByVal f, ByRef x, ByRef y)
	Set p = LoadPicture(f)
	x = CLng(CDbl(p.Width) * 24 / 635) ' CLng 의 라운드 오프의 기능을 이용하고 있다.
	y = CLng(CDbl(p.Height) * 24 / 635) ' CLng 의 라운드 오프의 기능을 이용하고 있다.
	Set p = Nothing 
	' Use
    '	GetImageSize server.MapPath("/")&"\image\"&big_image, x, y
End Sub


'########## 이메일 링크 처리
Function fn_email_link(chk_name,chk_email)

	If Trim(chk_email)<>"" Then
		chk_name="<a href=mailto:"&chk_email&">"&chk_name&"</a>"
	Else
		chk_name=chk_name
	End If

	fn_email_link = chk_name

End Function


'##########  String Length 계산                                 
Function lenH(str)                            
	Dim tlen, k, i, tt                    
	if isNULL(str) then                   
		lenH=0                        
		exit Function                 
	End if                                
	tlen=0                                
	tt=len(str)                           
	k=1                                   
	for i=1 to tt                         
		if asc(mid(str,k,1)) < 0 then 
			tlen=tlen+2           
		else                          
			tlen=tlen+1           
		End if                        
		k=k+1                         
	next                                  
	lenH=tlen                             
End Function                                  
                                                      
'##########  Left 기준 절삭                                     
Function leftH(str,cnt)                       
	Dim k, i, ss                          
	k=1                                   
	for i=0 to cnt                        
		if asc(mid(str,k,1)) <= 0 then
			if i=cnt-1 then       
				exit for      
				End if        
			i=i+1                 
		End if                        
		ss=ss & mid(str,k,1)          
		k=k+1                         
	next                                  
	leftH=ss                              
End Function                   

function uAutolink(contents)
	dim Matches, Match
	dim patrn
	'patrn = "(?!<a.*?>)" 
	patrn = "[^='"">]"
	patrn = patrn & "(http|https|ftp|mms):\/\/[0-9a-z-]+(\.[_0-9a-z-]+)+(:[0-9]{2,4})?\/?"   
	patrn = patrn & "([\.~_0-9a-z-]+\/?)*"
	patrn = patrn & "(\S+\.[_0-9a-z]+)?"
	patrn = patrn & "(\?[_0-9a-z각-힣#%&=\-\+]+)*"			

	set Matches = RegExpExec(patrn, contents, true)
	For Each Match In Matches
                        contents = replace(contents, Match.Value, "<a href='"&Match.Value&"' target='new'>"&Match.Value&"</a>")
	Next

	uAutolink = contents
end function

Public Function RegExpExec(Patrn, TestStr, bGlobal)  
	Dim ObjRegExp
	Set ObjRegExp = New RegExp

	ObjRegExp.Pattern = Patrn               '** 정규 표현식 패턴
	ObjRegExp.Global = True                 '** 문자열 전체를 검색함
	ObjRegExp.IgnoreCase = bGlobal             '** 대.소문자 구분 안함

	Set RegExpExec = ObjRegExp.Execute(TestStr)

	Set ObjRegExp = Nothing
End Function

'코드표 추출(대분류,중분류)
Function fn_codeAll(cd_gubun1,cd_gubun2)
	If cd_gubun1="" Then cd_gubun1=0
	If cd_gubun2<>"" Then
			chk_SQL3 = "SELECT A.P_NAME,B.F_CODE,B.F_NAME FROM TB_BASIC_CODE1 A,TB_BASIC_CODE2 B WHERE A.P_CODE=B.P_CODE AND B.P_CODE="&cd_gubun1&" AND B.F_CODE="&cd_gubun2&" "
'			Print(chk_SQL3)
			Set chk_Rs3 = Dbcon.Execute(chk_SQL3)
			If chk_Rs3.EOF Or chk_Rs3.BOF Then
				ouputCodeName=""
			Else
				ouputCodeName=chk_Rs3(0)&" -> "&chk_Rs3(2)
			End If
			Rs_Close(chk_Rs3)
	Else 
			chk_SQL3 = "SELECT A.P_NAME FROM TB_BASIC_CODE1 A WHERE A.P_CODE="&cd_gubun1&" "
'			Print(chk_SQL3)
			Set chk_Rs3 = Dbcon.Execute(chk_SQL3)
			If chk_Rs3.EOF Or chk_Rs3.BOF Then
				ouputCodeName=""
			Else
				ouputCodeName=chk_Rs3(0)
			End If
			Rs_Close(chk_Rs3)
	End If
	fn_codeAll = Replace(ouputCodeName,"***","")
End Function

'코드표 추출(추출구분 1:명칭,2:코드(숫자), 대분류,중분류,명칭)
Function fn_codeSelect(s_gubun,cd_gubun1,cd_gubun2,code_select)
	If cd_gubun1<>"" Then
		If s_gubun="1" AND Trim(cd_gubun2)<>"" Then
			chk_SQL3 = "SELECT B.F_CODE,B.F_NAME FROM TB_BASIC_CODE1 A,TB_BASIC_CODE2 B WHERE A.P_CODE=B.P_CODE AND B.P_CODE="&cd_gubun1&" AND B.F_CODE="&cd_gubun2&" AND A.P_USE='Y' AND B.F_USE='Y'"
//			Print(chk_SQL3)
			Set chk_Rs3 = Dbcon.Execute(chk_SQL3)
			If chk_Rs3.EOF Or chk_Rs3.BOF Then
				ouputCodeName=""
			Else
				ouputCodeName=chk_Rs3(1)
			End If
			Rs_Close(chk_Rs3)
		ElseIf s_gubun="3" AND Trim(cd_gubun1)<>"" AND Trim(cd_gubun2)="" Then ' 대분류 명칭
			chk_SQL3 = "SELECT A.P_CODE,A.P_NAME FROM TB_BASIC_CODE1 A WHERE A.P_CODE="&cd_gubun1
//			Print(chk_SQL3)
			Set chk_Rs3 = Dbcon.Execute(chk_SQL3)
			If chk_Rs3.EOF Or chk_Rs3.BOF Then
				ouputCodeName=""
			Else
				ouputCodeName=chk_Rs3(1)
			End If
//			Rs_Close(chk_Rs3)
		Else
//			chk_SQL3 = "SELECT B.F_CODE,B.F_NAME FROM TB_BASIC_CODE1 A,TB_BASIC_CODE2 B WHERE A.P_CODE=B.P_CODE AND B.P_CODE="&cd_gubun1&" AND B.F_NAME='"&code_select&"' AND A.P_USE='Y' AND B.F_USE='Y'"
//			Set chk_Rs3 = Dbcon.Execute(chk_SQL3)
//			If chk_Rs3.EOF Or chk_Rs3.BOF Then
//				ouputCodeName=""
//			Else
//				ouputCodeName=chk_Rs3(0)
//			End If
//			Rs_Close(chk_Rs3)
		End If
		fn_codeSelect = ouputCodeName
	End If
End Function

'영문 코드표 추출(추출구분 1:명칭,2:코드(숫자), 대분류,중분류,명칭)
Function fn_codeSelect_e(s_gubun,cd_gubun1,cd_gubun2,code_select)
	If cd_gubun1<>"" Then
		If s_gubun="1" AND Trim(cd_gubun2)<>"" Then
			chk_SQL3 = "SELECT B.F_CODE,B.F_NAME_E as F_NAME FROM TB_BASIC_CODE1 A,TB_BASIC_CODE2 B WHERE A.P_CODE=B.P_CODE AND B.P_CODE="&cd_gubun1&" AND B.F_CODE="&cd_gubun2&" AND A.P_USE='Y' AND B.F_USE='Y'"
//			Print(chk_SQL3)
			Set chk_Rs3 = Dbcon.Execute(chk_SQL3)
			If chk_Rs3.EOF Or chk_Rs3.BOF Then
				ouputCodeName=""
			Else
				ouputCodeName=chk_Rs3(1)
			End If
			Rs_Close(chk_Rs3)
		ElseIf s_gubun="3" AND Trim(cd_gubun1)<>"" AND Trim(cd_gubun2)="" Then ' 대분류 명칭
			chk_SQL3 = "SELECT A.P_CODE,A.P_NAME_E as P_NAME FROM TB_BASIC_CODE1 A WHERE A.P_CODE="&cd_gubun1
//			Print(chk_SQL3)
			Set chk_Rs3 = Dbcon.Execute(chk_SQL3)
			If chk_Rs3.EOF Or chk_Rs3.BOF Then
				ouputCodeName=""
			Else
				ouputCodeName=chk_Rs3(1)
			End If
//			Rs_Close(chk_Rs3)
		Else
//			chk_SQL3 = "SELECT B.F_CODE,B.F_NAME_E as F_NAME FROM TB_BASIC_CODE1 A,TB_BASIC_CODE2 B WHERE A.P_CODE=B.P_CODE AND B.P_CODE="&cd_gubun1&" AND B.F_NAME='"&code_select&"' AND A.P_USE='Y' AND B.F_USE='Y'"
//			Set chk_Rs3 = Dbcon.Execute(chk_SQL3)
//			If chk_Rs3.EOF Or chk_Rs3.BOF Then
//				ouputCodeName=""
//			Else
//				ouputCodeName=chk_Rs3(0)
//			End If
//			Rs_Close(chk_Rs3)
		End If
		fn_codeSelect_e = ouputCodeName
	End If
End Function

'코드표 추출(추출구분 1:명칭,2:코드(숫자), 대분류,중분류,명칭)
Function fn_menuSelect(menu_gb1,menu_cd1)
	If menu_gb1<>"" Then
			chk_SQL3 = "SELECT menu_nm as menu_nm1 FROM TB_MENU WHERE menu_id="&menu_gb1&" AND menu_cd='"&menu_cd1&"'"
//			Print(chk_SQL3)
			Set chk_Rs3 = Dbcon.Execute(chk_SQL3)
			If chk_Rs3.EOF Or chk_Rs3.BOF Then
				ouputMenuName=""
			Else
				ouputMenuName=chk_Rs3(0)
			End If
			Rs_Close(chk_Rs3)
		fn_menuSelect = ouputMenuName
	End If
End Function

' 코드표 추출(추출구분1:테이블명,2:필드명, 추출필드,아이디값)
Function fn_memName(f_tb,f_fld,f_nm,f_id)
	
'		If s_gubun="1" Then
			chk_SQL3 = "SELECT A."&f_nm&" FROM "&f_tb&" A WHERE A."&f_fld&"='"&f_id&"'"
			Set chk_Rs3 = Dbcon.Execute(chk_SQL3)
			If chk_Rs3.EOF Or chk_Rs3.BOF Then
				ouputCodeName=""
			Else
				ouputCodeName=chk_Rs3(0)
			Rs_Close(chk_Rs3)
			End If
'		End If
		fn_memName = ouputCodeName
'	End If
End Function

' 코드표 추출(모임구분1:명칭,2:코드(숫자), 대분류,중분류,명칭)
Function fn_codeMoim(s_gubun,cd_gubun1,cd_gubun2,code_select)
	
	If cd_gubun1<>"" Then
		If Len(cd_gubun1)=1 Then  cd_gubun1 = "0"&cd_gubun1
		If Not (isempty(cd_gubun2) or cd_gubun2="") Then
			If Len(cd_gubun2)=1 Then  cd_gubun2 = "0"&cd_gubun2
		End If
		If s_gubun="1" Then
			chk_SQL3 = "SELECT moim_nm FROM TB_MOIM WHERE moim_code='"&cd_gubun1&"'"
			Set chk_Rs3 = Dbcon.Execute(chk_SQL3)
			If chk_Rs3.EOF Or chk_Rs3.BOF Then
				ouputCodeName=""
			Else
				ouputCodeName=chk_Rs3(0)
			End If
		Else
			chk_SQL3 = "SELECT A.MAJ_CATEGORY_CODE,A.MAJ_CATEGORY_NAME FROM TB_MAJOR_CATEGORY A WHERE A.MAJ_UPGRADE_CHK='Y' AND A.MAJ_CATEGORY_USE='Y' AND MAJ_CATEGORY_CODE='"&cd_gubun1&"'"
			Set chk_Rs3 = Dbcon.Execute(chk_SQL3)
			If chk_Rs3.EOF Or chk_Rs3.BOF Then
				ouputCodeName=""
			Else
				ouputCodeName=chk_Rs3(0)
			End If
		End If
		Rs_Close(chk_Rs3)
		fn_codeMoim = ouputCodeName
	End If
End Function

' 코드표 추출(추출구분1:동문회원(기수),2:동문회원(이름),3:회원명단추출,6:소모임 연락처, 7:소모임 이메일 대분류,중분류,명칭)
SUB fn_memSelect(fn_mem_Gubun,mem_Id,mem_Field)
	
	If fn_mem_Gubun<>"" Then
		If fn_mem_Gubun="1" AND Trim(mem_Id) <> "" Then
			chk_SQL2 = "SELECT "&mem_Field&" FROM TB_MEMBER WHERE id= '"&mem_Id&"' AND mem_gubun='1'"
'			Print(chk_SQL2)
			Set code_Rs2 = Dbcon.Execute(chk_SQL2)
			If code_Rs2.EOF Or code_Rs2.BOF Then
				ouputCodeName=""
			Else
				If code_Rs2(0)>0 Then 
					ouputCodeName="<font style='font-size:8pt;color:#6666FF'>("&code_Rs2(0)&"기)</font>"
				Else
					ouputCodeName=""
				End If
			End If
			Response.write ouputCodeName
			Rs_Close(code_Rs2)

		ElseIf fn_mem_Gubun="2" Then

			chk_SQL2 = "SELECT name,mem_gubun,email FROM TB_MEMBER WHERE id= '"&mem_Id&"'"
'			Print(chk_SQL2)
			Set code_Rs2 = Dbcon.Execute(chk_SQL2)
			If code_Rs2.EOF Or code_Rs2.BOF Then
				ouputCodeName="&nbsp;"
			Else
				If code_Rs2("mem_gubun")="1" Then
					ouputCodeName = code_Rs2("name")&"("&code_Rs2("times")&"기)"
				Else
					ouputCodeName = code_Rs2("name")
				End If
			End If
			Response.write ouputCodeName
			Rs_Close(code_Rs2)

		ElseIf fn_mem_Gubun="3" Then

			chk_SQL2 = "SELECT "&mem_Field&" FROM TB_MEMBER WHERE id= '"&mem_Id&"'"
			Set code_Rs2 = Dbcon.Execute(chk_SQL2)
			If code_Rs2.EOF Or code_Rs2.BOF Then
				ouputCodeName="&nbsp;"
			Else
				ouputCodeName="("&code_Rs2(0)&")"
			End If
			Response.write ouputCodeName
			Rs_Close(code_Rs2)

		ElseIf fn_mem_Gubun="6" Then

			chk_SQL2 = "SELECT pcs1,h_tel FROM TB_MEMBER WHERE id= '"&mem_Id&"'"
			Set code_Rs2 = Dbcon.Execute(chk_SQL2)
			If code_Rs2.EOF Or code_Rs2.BOF Then
				ouputCodeName="&nbsp;"
			Else
				If Trim(code_Rs2(0))="" Then 
					ouputCodeName=code_Rs2(1)
				Else
					ouputCodeName=code_Rs2(0)
				End If
			End If
			Response.write ouputCodeName
			Rs_Close(code_Rs2)

		ElseIf fn_mem_Gubun="7" Then

			chk_SQL2 = "SELECT email FROM TB_MEMBER WHERE id= '"&mem_Id&"'"
			Set code_Rs2 = Dbcon.Execute(chk_SQL2)
			If code_Rs2.EOF Or code_Rs2.BOF Then
				ouputCodeName="&nbsp;"
			Else
				If Trim(code_Rs2(0))="" Then 
					ouputCodeName="&nbsp;"
				Else
					ouputCodeName=code_Rs2(0)
				End If
			End If
			Response.write ouputCodeName
			Rs_Close(code_Rs2)

		End If
'		fn_memSelect = ouputCodeName
	End If
End SUB 

'########## 홈페이지 링크 처리
Function fn_home_link(chk_home_nm,chk_home_url)

	If Trim(chk_home_url)<>"" Then
		chk_url="<a href=http://"&Replace(chk_home_url,"http://","")&" target='_blank'>"&chk_home_nm&"</a>"
	Else
		chk_url=chk_home_nm
	End If
	fn_home_link=chk_url

End Function

'########## 파일첨부시 파일 링크 처리
Function fn_file_icon(fileObjgb,fileObjnm,fileObjfld,fileObjchk,folder_nm)

	If Trim(fileObjnm)<>"" Then
		strFileExt = LCase(mid(fileObjnm,instrrev(fileObjnm,".")+1))
		If Trim(fileObjgb)="icon" Then
				RootFilePath = Server.MapPath("/dataroom/"&folder_nm)&"\"&fileObjnm
				Set FSO = CreateObject("Scripting.FileSystemObject")
				If FSO.FileExists(RootFilePath) Then ' 파일 존재 여부 체크
					If FSO.FileExists(Server.MapPath("/images/file")&"\"&strFileExt&".gif") Then
						strFileExt = "<a href='/inc/down.asp?TB_NAME="&TB_NAME&"&idx="&idx&"&f_gubun="&fileObjfld&"&file_dir="&folder_nm&"'><img src=/images/file/"&strFileExt&".gif border=0 hspace=1></a>"
					Else
						strFileExt = "<a href='/inc/down.asp?TB_NAME="&TB_NAME&"&idx="&idx&"&f_gubun="&fileObjfld&"&file_dir="&folder_nm&"'><img src=/images/file/etc.gif border=0 hspace=1></a>"
					End If
				Else
					strFileExt = ""
'					strFileExt = "<a href='/inc/down.asp?TB_NAME="&TB_NAME&"&idx="&idx&"&f_field="&fileObjfld&"&f_dir="&folder_nm&"'><img src=/images/file/etc.gif border=0 hspace=1></a>"
				End If
				Set FSO = Nothing
		Else
			strFileExt = "&nbsp;<a href='/inc/down.asp?TB_NAME="&TB_NAME&"&idx="&idx&"&f_gubun="&fileObjfld&"&file_dir="&folder_nm&"'><font color='#CC6600'>"&fileObjnm&"</font></a>"
		End If
	Else
		strFileExt = LCase(mid(fileObjnm,instrrev(fileObjnm,".")+1))
		strFileExt = "&nbsp;"
	End If

	fn_file_icon = strFileExt

End Function

'########## 업무공간 파일첨부시 파일 링크 처리 fileObj_tb:테이블명,folder_nm:저장폴더,f_idx:글번호
Function fn_bizfile_icon(fileObjgb,fileObjnm,fileObjfld,fileObjchk,fileObj_tb,folder_nm,f_idx)

	If Trim(fileObjnm)<>"" Then
		strFileExt = LCase(mid(fileObjnm,instrrev(fileObjnm,".")+1))
		If Trim(fileObjgb)="icon" Then
				RootFilePath = Server.MapPath("/dataroom/"&folder_nm)&"\"&fileObjnm
				Set FSO = CreateObject("Scripting.FileSystemObject")
				If FSO.FileExists(RootFilePath) Then ' 파일 존재 여부 체크
					If FSO.FileExists(Server.MapPath("/images/file")&"\"&strFileExt&".gif") Then
						strFileExt = "<a href='/inc/down.asp?TB_NAME="&fileObj_tb&"&idx="&f_idx&"&f_gubun="&fileObjfld&"&file_dir="&folder_nm&"'><img src=/images/file/"&strFileExt&".gif border=0 hspace=1></a>"
					Else
						strFileExt = "<a href='/inc/down.asp?TB_NAME="&fileObj_tb&"&idx="&f_idx&"&f_gubun="&fileObjfld&"&file_dir="&folder_nm&"'><img src=/images/file/etc.gif border=0 hspace=1></a>"
					End If
				Else
					strFileExt = ""
'					strFileExt = "<a href='/inc/down.asp?TB_NAME="&TB_NAME&"&idx="&idx&"&f_field="&fileObjfld&"&f_dir="&folder_nm&"'><img src=/images/file/etc.gif border=0 hspace=1></a>"
				End If
				Set FSO = Nothing
		Else
			strFileExt = "&nbsp;<a href='/inc/down.asp?TB_NAME="&fileObj_tb&"&idx="&idx&"&f_gubun="&fileObjfld&"&file_dir="&folder_nm&"'><font color='#CC6600'>"&fileObjnm&"</font></a>"
		End If
	Else
'		strFileExt = LCase(mid(fileObjnm,instrrev(fileObjnm,".")+1))
		strFileExt = "&nbsp;"
	End If

	fn_bizfile_icon = strFileExt

End Function

'======================================================== 
' 날짜와 시간을 형식에 맞춰 변환한다. 
' 대문자는 날짜, 소문자는 시간 
' Y, M, D, t, h, m, s 

'얻고자 하는 값==> "2000년10월31일" 
'   Response.Write FormatDate(now, "Y년M월D일") 
'얻고자 하는 값==> "2000년 10월 31일" 
'   Response.Write FormatDate(now, Y년 M월 D일") 
'얻고자 하는 값==> "2000-10" 
'   Response.Write FormatDate(now, "Y-M") 
'얻고자 하는 값==> "17시20분59초" 
'   Response.Write FormatDate(now, "h시m분s초") 
'얻고자 하는 값==> "17:20:59" 
'   Response.Write FormatDate(now, "h:m:s") 
'얻고자 하는 값==> "17:20" 
'   Response.Write FormatDate(now, "h:m") 
'얻고자 하는 값==> "오후 5시20분59초" 
'   Response.Write FormatDate(now, t h시m분s초) 
'얻고자 하는 값==> "2000년 10월 31일 오후 5시 20분 59초" 
'   Response.Write FormatDate(now, "Y년 M월 D일 t h시 m분 s초") 
'얻고자 하는 값==> "59초 20분 5시 오후 31일 10월 2000년" 
'   Response.Write FormatDate(now, "s초 m분 h시 t D일 M월 Y년") 
'*내장된 예약어로는 
'얻고자 하는 값==> "2000년10월31일" 
'   Response.Write FormatDate(now, "") 또는 
'   Response.Write FormatDate(now, "DATE") 
'얻고자 하는 값==> "2000년10월31일 오후 5시20분50초" 
'   Response.Write FormatDate(now, "DATETIME") 
'얻고자 하는 값==> "오후5시20분59초" 
'   Response.Write FormatDate(now, "TIME") 
'======================================================== 

Function FormatDate(dt,aform)

	If Trim(dt)<>"" AND isdate(dt) Then

    dim syear, smonth, sday, shour, sminute, ssecond 
    dim lyear, lmonth, lday, lhour, lminute, lsecond 
    dim is12, s12 
    dim form 
    dim i, cnt 
    dim str, c, oldc 
         
    syear=year(dt) 
    smonth=month(dt) 
    sday=day(dt) 
    shour=hour(dt) 
    sminute=minute(dt) 
    ssecond=second(dt) 

    form=trim(aform) 
    if form="" then form="DATE" 
    select case ucase(form) 
    case "DATETIME" 
        form="Y년M월D일 th시m분s초 " 
    case "DATE" 
        form="Y년M월D일 " 
    case "TIME" 
        form="th시m분s초 " 
    end select 

    lyear=len(form)-len(replace(form, "Y", "")) 
    lmonth=len(form)-len(replace(form, "M", "")) 
    lday=len(form)-len(replace(form, "D", "")) 
    lhour=len(form)-len(replace(form, "h", "")) 
    lminute=len(form)-len(replace(form, "m", "")) 
    lsecond=len(form)-len(replace(form, "s", "")) 
    is12=instr(form, "t") 

    syear=FormatStr(syear, string(lyear, "0")) 
    smonth=FormatStr(smonth, string(lmonth, "0")) 
    sday=FormatStr(sday, string(lday, "0")) 
    shour=FormatStr(shour, string(lhour, "0")) 
    sminute=FormatStr(sminute, string(lminute, "0")) 
    ssecond=FormatStr(ssecond, string(lsecond, "0")) 

    if is12 then 
        s12="오전 "
        if shour > 12 then 
            s12="오후 "
            shour=shour-12 
        end if             
    end if 

    cnt=len(form) 
    i=1 
    do until i>cnt 
        c=mid(form, i, 1) 
        if c <> oldc then 
            oldc=c 
            select case c 
            case "Y" 
                str=str & syear 
            case "M" 
                str=str & smonth 
            case "D" 
                str=str & sday 
            case "t" 
                str=str & s12 
            case "h" 
                str=str & shour 
            case "m" 
                str=str & sminute 
            case "s" 
                str=str & ssecond 
            case else         
                str=str & c 
            end select 
        end if 
        i=i+1 
    Loop 
         
    FormatDate = str 

	Else

    FormatDate = dt 

	End If
End Function

Function FormatDateSms(dt)

	If Trim(dt)<>"" AND Len(dt)=8 Then
		
		str_yymmdd = Left(dt,4)&"년 "&Mid(dt,5,2)&"월 "&right(dt,2)&"일 "
		FormatDateSms = str_yymmdd 

	Else

		FormatDateSms = dt 

	End If

End Function

Function FormatWeekSms(dt)

	If Trim(dt)<>""  Then
		
		str_week = Weekdayname(Weekday(Cdate(dt))) 
		FormatWeekSms = str_week 

	Else

		FormatWeekSms = dt 

	End If

End Function

Function FormatDateReplace(sDate,Patt) 
    If len(sDate) > 6 Then 
        DateReplace=Left(sDate,4)&Patt&Mid(sDate,6,2)&Patt&Mid(sDate,9,2)
    Else 
        DateReplace=Left(sDate,2)&Patt&Mid(sDate,3,2)&Patt&Mid(sDate,9,2)
    End If 
	FormatDateReplace = DateReplace
End Function

Function FormatStr(s, form) 
    If len(s) > len(form) Then 
        FormatStr=s 
    Else 
        FormatStr=left(form, len(form)-len(s)) & s 
    End If 
End Function

'용량단위 
'단위  명 칭 의미 표 현
'KB 킬로(kilo)바이트 210바이트 1,024바이트
'MB 메가(mega)바이트 220바이트 1,048,576바이트
'GB 기가(giga)바이트 230바이트 1,073,741,824바이트
'TB 테라(tera)바이트 240바이트 1,099,511,627,776바이트

'1KB(Kilo Byte) = 1,024byte
'1MB(Mega Byte) = 1,024kb
'1GB(Giga Byte) = 1,024mb
'1TB(Tera Byte) = 1,024gb
'1PB(Peta Byte) = 1,024tb
 
'1024KB = 1MB
'KB(KiloByte) = 1,000B = 10의 3승 바이트(1천 바이트) 
'MB(MegaByte) = 1,000KB = 10의 6승 바이트(1백만 바이트) 
'GB(GigaByte) = 1,000MB = 10의 9승 바이트(10억 바이트) 
'TB(TeraByte) = 1,000GB = 10의 12승 바이트(1조 바이트) 
'PB(PetaByte) = 1,000TB = 10의 15승 바이트(1천조 바이트) 
'EB(ExaByte) = 1,000PB = 10의 18승 바이트(기가의 기가 바이트=100경 바이트) 

'****************************************************************************************
'* 해당 파일의 크기를 받아서 특정한 형태의 문자열로 변환해 리턴해 주는 매우 간단한 문자열 조작 메소드.
'****************************************************************************************
Public Function CalcSize(FSize)

    Dim FSizeStr
    
 On Error Resume Next

    If (FSize / 1000000) > 1 Then
        FSize = FormatNumber(FSize / 1000000, 1, -1)
        If Right(CStr(FSize), 2) = ".0" Then
            FSize = Left(FSize, Len(FSize) - 2)
        End If
        FSizeStr = FSize & " MB"
    ElseIf (FSize / 1000) > 1 Then
        FSize = FormatNumber(FSize / 1000, 1, -1)
        If Right(CStr(FSize), 2) = ".0" Then
            FSize = Left(FSize, Len(FSize) - 2)
        End If
        FSizeStr = FSize & " KB"
    Else
        FSize = FormatNumber(FSize, 1, -1)
        If Right(CStr(FSize), 2) = ".0" Then
            FSize = Left(FSize, Len(FSize) - 2)
        End If
        FSizeStr = FSize & " Byte"
    End If
    
    CalcSize = FSizeStr
    
End Function

Function no_html_frm(contents)

	if IsNULL(contents) Then contents = ""
	contents = trim(contents)                                 '앞, 뒤 공백제거
'contents = replace(replace(contents,"<","&lt;"),">","&gt;")    '<, > 처리
'	contents = replace(contents,chr(13)&chr(10),"<br>")        'Enter 처리
'	contents = replace(contents,chr(13),"<br>")        'Enter 처리
'	contents = replace(contents,chr(32),"&nbsp;")              'Space Bar 처리
'	contents = replace(contents," ","&nbsp;")              'Space Bar 처리
'contents = replace(contents,chr(9),"&nbsp;&nbsp;&nbsp;&nbsp;") 'Tab 처리
	contents = replace(contents,"''","'")              '작은따옴표(') 처리

'	contents = replace(contents,"&lt;b&gt;","<font color='#336699'><b>") 'Asp 코드..처리
'	contents = replace(contents,"&lt;/b&gt;","</b></font>")
'	contents = replace(contents,"&lt;%","<font color='#800000'>&lt;%") 'Asp 코드..처리
'	contents = replace(contents,"%&gt;","%&gt;</font>")

	no_html_frm = contents

End Function

 Public Function Injection(ByVal str)
  str = eregi_replace(";", "", str)
  str = eregi_replace("--", "", str)
  str = eregi_replace("\@variable ", "", str)
  str = eregi_replace("\@@variable ", "", str)
  str = eregi_replace("\+", "", str)
'  str = eregi_replace("\*", "", str)
  str = eregi_replace("print ", "", str)
  str = eregi_replace("set ", "", str)
'  str = eregi_replace("\% ", "", str)
  str = eregi_replace("or ", "", str)
'  str = eregi_replace("or1", "", str)
  str = eregi_replace("and ", "", str)
  str = eregi_replace("union ", "", str)
  str = eregi_replace("insert ", "", str)
  str = eregi_replace("select ", "", str)
  str = eregi_replace("update ", "", str)
  str = eregi_replace("create ", "", str)
  str = eregi_replace("drop ", "", str)
  str = eregi_replace("openrowset ", "", str)
  str = eregi_replace("exec ", "", str)
  Injection  = str
 End Function

'HTML 태그를 정규식으로 없애줌
FUNCTION REMOVETAGS(BYVAL STR)
 IF NOT ISNULL(STR) THEN
   DIM REGEX
   ' 정규표현식 객체
   SET REGEX = NEW REGEXP
   ' 자바스크립트 제거 
   REGEX.PATTERN = "<script[^>]*>[\W|\w]*?</script>"
   REGEX.IGNORECASE = TRUE 'false(대소문자구분), true(구분안함, 기본)
   REGEX.GLOBAL = TRUE 'true(전체문자열), false(처음것만, 기본)
   STR = REGEX.REPLACE(STR, "")
   SET REGEX = NOTHING
   SET REGEX = NEW REGEXP
   ' 주석제거
   REGEX.PATTERN = "<!--[\W|\w]*?-->"
   REGEX.IGNORECASE = TRUE 'false(대소문자구분), true(구분안함, 기본)
   REGEX.GLOBAL = TRUE 'true(전체문자열), false(처음것만, 기본)
   STR = REGEX.REPLACE(STR, "")
   SET REGEX = NOTHING
   ' HTML태그 제거
   SET REGEX = NEW REGEXP
   REGEX.PATTERN = "<[\/\!]*?[^<>]*?>"
   REGEX.IGNORECASE = TRUE 'false(대소문자구분), true(구분안함, 기본)
   REGEX.GLOBAL = TRUE 'true(전체문자열), false(처음것만, 기본)
   REMOVETAGS = REPLACE(REGEX.REPLACE(STR, ""),"'","")
   REMOVETAGS = REPLACE(REMOVETAGS,"%","")
   SET REGEX = NOTHING
 ELSE
   REMOVETAGS = STR
 END IF
END FUNCTION 

'########## 문자변환
Function fn_str_replace(str_txt,str_src,str_tgt)
'	Response.write keyword_find
	If Trim(str_txt)<>"" Then
		str_result=Replace(str_txt, str_src ,str_tgt)
	Else
		str_result = str_txt
	End If
	fn_str_replace = Trim(str_result)
End Function

'########## 검색단어색상변경
Function fn_keyword_search(keyword_subject,keyword_find)
'	Response.write keyword_find
	If Trim(keyword_find)<>"" Then
		keyword_result=Replace(keyword_subject, keyword_find ,"<span class='tot_find_txt'>"&keyword_find&"</span>", 1, -1, 1)

'		start=1 : 검색시작부분(기본값)
'		count=-1 : 모두(기본값)
'		compare 0:vbBinaryCompare(대소문자 구분), 1:vbTextCompare(대소문자 미구분)

'		keyword_result=Replace((keyword_subject), (keyword_find) ,"<span class='red_02'>"&keyword_find&"</span>")
'		keyword_result=Replace(UCase(keyword_subject), UCase(keyword_find) ,"<span class='red_02'>"&keyword_find&"</span>")
	Else
		keyword_result = keyword_subject
	End If
	fn_keyword_search = Trim(keyword_result)
End Function

'Random 발생기 :자리수
Function fn_random_maker(random_su)
	Dim random_str,random_code 
	random_str = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789" 
	random_code = ""
	Randomize '랜덤 초기화 
	Dim r, i
	For i = 1 to random_su 
		r = Int((36 - 1 + 1) * Rnd + 1) ' 36은 str의 갯수 
		random_code = random_code + Mid(random_str,r,1) 
'		아래는 4번째 자리마다 - 넣기 
'		if ds = 3 then 
'			serialCode = serialCode + "-" 
'			ds = 0 
'		else 
'			ds = ds+1 
'		end if 
	Next 
	fn_random_maker = random_code
End Function
random_num = fn_random_maker(8) '스팸등록 방지를 위한 랜덤 8자리 영숫자 조합 발생

'매달 말일 구하기
Function Get_Lastday(nYear, nMonth)
    Get_Lastday = Day(DateSerial(nYear, nMonth + 1, 1 - 1))
End Function

'요일 구하기
Function Get_weekDay(nYmd)
	weekDay1 = weekDay(CDate(nYmd))
	Select case weekDay1
	case "1" weekDay1 = "일"
	case "2" weekDay1 = "월"
	case "3" weekDay1 = "화"
	case "4" weekDay1 = "수"
	case "5" weekDay1 = "목"
	case "6" weekDay1 = "금"
	case "7" weekDay1 = "토"
	End Select
	Get_weekDay = weekDay1
End Function


'한글,영문,숫자가 섞인 문자열에서 항상 일정한 길이로 자르기
function LeftCut(strString, intCut)

    dim intPos, chrTemp, strCut, intLength
    '문자열 길이 초기화
    intLength = 0
    intPos = 1

    '문자열 길이만큼 돈다
    do while ( intPos <= Len( strString ))

       '문자열을 한문자씩 비교한다
        chrTemp = ASC(Mid( strString, intPos, 1))

        if chrTemp < 0 then '음수값(-)이 나오면 한글임
          strCut = strCut & Mid( strString, intPos, 1 ) 
          intLength = intLength + 2  '한글일 경우 문자열 길이를 2를 더한다 
        else
          strCut = strCut & Mid( strString, intPos, 1 )            
          intLength = intLength + 1  '한글이 아닌경우 문자열 길이를 1을 더한다
        end If

        if intLength >= intCut  then
           exit do
        end if

        intPos = intPos + 1
  
    Loop

    '리턴값
    LeftCut = strCut

 end function

'레코드셋 읽어서 변수 자동 생성 
Sub MakeRsVar(pRs)
    dim obj, i : i = 0
    for each obj in pRs.Fields
        Response.Write "Dim db_" & obj.name & "<br>"
    next
    Response.Write "<br>"
    for each obj in pRs.Fields
        Response.Write "db_" & obj.name & " = rs(" & i & ")<br>"
        i = i + 1
    next
End Sub

'Base64 Encoding File Upload in Classic ASP
Function SaveToBase64 (base64String)
    Set Doc = Server.CreateObject("MSXML2.DomDocument")
    Set nodeB64 = Doc.CreateElement("b64")
    nodeB64.DataType = "bin.base64"
    nodeB64.Text = Mid(base64String, InStr(base64String, ",") + 1)

    dim bStream
    set bStream = server.CreateObject("ADODB.stream")
    bStream.type =  1
    call bStream.Open()
    call bStream.Write( nodeB64.NodeTypedValue )
    call bStream.SaveToFile("e:\test.jpg", 2 )
    call bStream.close()
    set bStream = nothing
End Function
Function BytesToStr(bytes)
    Dim Stream
    Set Stream = Server.CreateObject("Adodb.Stream")
        Stream.Type = 1 'adTypeBinary
        call Stream.Open
         Stream.Write bytes
        Stream.Position = 0
        Stream.Type = 2 'adTypeText
        Stream.Charset = "iso-8859-1"
        BytesToStr = Stream.ReadText
        call Stream.Close
    Set Stream = Nothing
End Function
'If Request.ServerVariables("REQUEST_METHOD") = "POST" Then
'	Dim CanvasStream
'	Dim lngBytesCount
'	lngBytesCount = Request.TotalBytes
'	SaveToBase64(BytesToStr(Request.BinaryRead(lngBytesCount)))
'End If
Function GetRSArray(strSQL)
    Set objRS = Dbcon.Execute(strSQL)
    If Not objRS.EOF Then arrRS = objRS.GetRows()
    Set objRS = Nothing
    GetRSArray = arrRS
End Function

Const sBASE_64_CHARACTERS ="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/" 

function Base64decode(ByVal asContents)
           Dim lsResult
           Dim lnPosition
           Dim lsGroup64, lsGroupBinary
           Dim Char1, Char2, Char3, Char4
           Dim Byte1, Byte2, Byte3
           if Len(asContents) Mod 4 > 0 _
          Then asContents = asContents & String(4 - (Len(asContents) Mod 4), " ")
           lsResult = ""

           For lnPosition = 1 To Len(asContents) Step 4
                   lsGroupBinary = ""
                   lsGroup64 = Mid(asContents, lnPosition, 4)
                   Char1 = INSTR(sBASE_64_CHARACTERS, Mid(lsGroup64, 1, 1)) - 1
                   Char2 = INSTR(sBASE_64_CHARACTERS, Mid(lsGroup64, 2, 1)) - 1
                   Char3 = INSTR(sBASE_64_CHARACTERS, Mid(lsGroup64, 3, 1)) - 1
                   Char4 = INSTR(sBASE_64_CHARACTERS, Mid(lsGroup64, 4, 1)) - 1
                   Byte1 = Chr(((Char2 And 48) \ 16) Or (Char1 * 4) And &HFF)
                   Byte2 = lsGroupBinary & Chr(((Char3 And 60) \ 4) Or (Char2 * 16) And &HFF)
                   Byte3 = Chr((((Char3 And 3) * 64) And &HFF) Or (Char4 And 63))
                   lsGroupBinary = Byte1 & Byte2 & Byte3

                   lsResult = lsResult + lsGroupBinary
           Next
Base64decode = lsResult
End function

function Base64encode(ByVal asContents)
        Dim lnPosition
        Dim lsResult
        Dim Char1
        Dim Char2
        Dim Char3
        Dim Char4
        Dim Byte1
        Dim Byte2
        Dim Byte3
        Dim SaveBits1
        Dim SaveBits2
        Dim lsGroupBinary
        Dim lsGroup64

        if Len(asContents) Mod 3 > 0 Then _
        asContents = asContents & String(3 - (Len(asContents) Mod 3), " ")
        lsResult = ""

        For lnPosition = 1 To Len(asContents) Step 3
               lsGroup64 = ""
               lsGroupBinary = Mid(asContents, lnPosition, 3)

               Byte1 = Asc(Mid(lsGroupBinary, 1, 1)): SaveBits1 = Byte1 And 3
               Byte2 = Asc(Mid(lsGroupBinary, 2, 1)): SaveBits2 = Byte2 And 15
               Byte3 = Asc(Mid(lsGroupBinary, 3, 1))

               Char1 = Mid(sBASE_64_CHARACTERS, ((Byte1 And 252) \ 4) + 1, 1)
               Char2 = Mid(sBASE_64_CHARACTERS, (((Byte2 And 240) \ 16) Or _
               (SaveBits1 * 16) And &HFF) + 1, 1)
               Char3 = Mid(sBASE_64_CHARACTERS, (((Byte3 And 192) \ 64) Or _
               (SaveBits2 * 4) And &HFF) + 1, 1)
               Char4 = Mid(sBASE_64_CHARACTERS, (Byte3 And 63) + 1, 1)
               lsGroup64 = Char1 & Char2 & Char3 & Char4

               lsResult = lsResult + lsGroup64
         Next

         Base64encode = lsResult
End function

Function Base64Data2Stream(sData)
    Set Base64Data2Stream = Server.CreateObject("Adodb.Stream")
        Base64Data2Stream.Type = 1 'adTypeBinary
        Base64Data2Stream.Open
    With Server.CreateObject("MSXML2.DomDocument.3.0").createElement("b64")
        .dataType = "bin.base64"
        .text = sData
        Base64Data2Stream.Write .nodeTypedValue 'write bytes of decoded base64 to stream
        Base64Data2Stream.Position = 0
    End With
End Function

%>